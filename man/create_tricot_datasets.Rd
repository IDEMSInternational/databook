% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/databook_functions.R
\name{create_tricot_datasets}
\alias{create_tricot_datasets}
\title{Create and Structure Tricot Data at Multiple Levels}
\usage{
create_tricot_datasets(
  output_data_levels,
  id_level_data = "",
  id_col = "id",
  data_trait_cols = NULL,
  carry_cols = NULL,
  traits = NULL,
  variety_cols = NULL,
  rank_values = NULL,
  prefix = NULL,
  good_suffixes = c("_pos", "_best"),
  bad_suffixes = c("_neg", "_worst"),
  na_candidates = c("Not observed", "Not scored", NA_character_)
)
}
\arguments{
\item{output_data_levels}{A tibble produced by \code{instatExtras::summarise_data_levels()}
describing available datasets and their detected levels. Must include at least one
dataset with \code{level == "id"}.}

\item{id_level_data}{Optional string naming a dataset to use as the ID level if none
are detected automatically. Defaults to \code{""}, in which case detection errors if
no ID-level dataset is found.}

\item{id_col}{Character name of the ID column. Only used when specifying \code{id_level_data}.}

\item{data_trait_cols}{Optional character vector of trait-indicator columns to pass
to \code{pivot_tricot()} when constructing plot data.}

\item{carry_cols}{Optional character vector of columns to carry through to the plot-level
pivoted data.}

\item{traits}{Deprecated. Use \code{data_trait_cols} instead.}

\item{variety_cols}{Character vector of variety columns (for \code{detect_tricot_structure()}).}

\item{rank_values}{Character vector of possible rank values (for \code{detect_tricot_structure()}).}

\item{prefix}{Optional string prefix for trait columns (for \code{detect_tricot_structure()}).}

\item{good_suffixes}{Character vector of suffixes indicating positive rankings
(e.g. \code{"_pos"}, \code{"_best"}).}

\item{bad_suffixes}{Character vector of suffixes indicating negative rankings
(e.g. \code{"_neg"}, \code{"_worst"}).}

\item{na_candidates}{Character vector of values treated as missing (e.g.
\code{c("Not observed", "Not scored", NA_character_)}). Only the first value is used.}
}
\value{
A tibble mirroring \code{output_data_levels} with any new plot- and variety-level
dataset entries and a \code{trait_names} list-column of detected trait labels.
}
\description{
Detects the appropriate tricot data levels (ID, plot, plot–trait, variety) from a
summary of input datasets, pivots or constructs missing levels using \code{pivot_tricot()},
and registers all levels in the \code{data_book} with associated metadata (ID, variety,
trait keys) and ranking summaries.
}
\details{
\enumerate{
\item Ensures exactly one dataset is assigned to each data level in
\code{output_data_levels}, allowing manual override via \code{id_level_data}.
\item Detects tricot structure (options, trait suffixes, rank levels) with
\code{detect_tricot_structure()} on the ID-level dataset.
\item Constructs or pivots plot-level data using \code{pivot_tricot()}, combining
ID-level and plot–trait data if provided.
\item Imports the new plot-level data into \code{data_book}, naming it \verb{<id_dataset>_plot}.
\item Summarises plot-level data by variety, creating a \verb{<plot_dataset>_by_variety} table.
\item Updates and returns \code{output_data_levels}, adding any newly created plot or variety
datasets and the list of detected trait names.
}
}
\examples{
# Suppose summarise_data_levels() returned:
odl <- tibble::tibble(
  dataset = c("df_id", "df_plot_trait"),
  level   = c("id", "plot-trait"),
  id_col  = c("id", "id"),
  variety_col = c(NA, "variety"),
  trait_col   = c(NA, "trait")
)
create_tricot_datasets(
  output_data_levels = odl,
  id_col = "id",
  variety_cols = c("option_a","option_b","option_c")
)

}
